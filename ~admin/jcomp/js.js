;(function($,doc,win){$.mx={version:'1.0',global:{},sysmenu:{},mappdata:{bool:['否','是']},formbefun:{},fdjsplus:{},height:function(){if($.browser.msie&&$.browser.version<7){var scrollHeight=Math.max(doc.documentElement.scrollHeight,doc.body.scrollHeight);var offsetHeight=Math.max(doc.documentElement.offsetHeight,doc.body.offsetHeight);if(scrollHeight<offsetHeight){return $(win).height()}else{return scrollHeight}}else{return $(win).height()}},width:function(){if($.browser.msie&&$.browser.version<7){var scrollWidth=Math.max(doc.documentElement.scrollWidth,doc.body.scrollWidth);var offsetWidth=Math.max(doc.documentElement.offsetWidth,doc.body.offsetWidth);if(scrollWidth<offsetWidth){return $(win).width()}else{return scrollWidth}}else{return $(win).width()}},getparam:function(){var hash=win.location.hash,hashstr=hash.substr(1,hash.length),epara=hashstr.split("&"),res={};for(var i=0;i<epara.length;i++){var epram=epara[i].split("=");if(epram[0])res[epram[0]]=epram[1]}return res},setparam:function(k,v){var get=this.getparam(),hash=[];get[k]=v;for(var i in get){if(get[i]!='')hash.push(i+"="+get[i])}win.location.hash=hash.join("&")},autowarp:function(){var me=$.mx,gl=me.global;gl.height=me.height();gl.width=me.width();$("[cutmargin]").each(function(i,o){var ctwh=$(o).attr("cutmargin")||'0,0',ectwh=ctwh.split(",");if(ectwh[0]>0)$(o).css('width',gl.width-ectwh[0]);if(ectwh[1]>0)$(o).css('height',gl.height-ectwh[1])});var omask=$("#mx-submitting");if(omask.length>0){omask.css({width:gl.width,height:gl.height})}},tabs:function(){$("#header-tabs-ul >li").click(function(){$('[itip]').poshytip('hide');var me=$(this),_url=me.attr("url"),_eq=me.attr("eq");win.location.hash="tab="+_eq;$("#header-tabs-ul >li").each(function(i,o){$(o).removeClass("ui-tabs-selected ui-state-active")});$(this).addClass("ui-tabs-selected ui-state-active");$.mx.sysmenu.tab={id:_eq,title:me.text(),url:_url};mxmask('正在加载...');$("#mx-tabs-content").load(_url,function(){loadpubfn()})});var get=this.getparam(),tabindex=get['tab']?get['tab']:0,tabs=$("#header-tabs-ul >li").eq(tabindex),_url=tabs.attr("url");tabs.addClass("ui-tabs-selected ui-state-active");$.mx.sysmenu.tab={id:tabindex,title:tabs.text(),url:_url};$("#mx-tabs-content").load(_url,function(){loadpubfn()})},load:function(){var me=this;me.tabs();me.autowarp();loadpubfn();$("#mx-theme-listview a").click(function(){$("#mx-theme-listview a").not(this).each(function(i,o){$(this).removeClass("selected")});$(this).toggleClass("selected")});$(win).resize(me.autowarp)}}})(jQuery,document,window);function loadpubfn(){$("#mx-submitting").hide();$('[itip]').poshytip('hide');$.mx.autowarp();$(".mx-mapping").each(function(i,o){var v=$(o).text(),k=$(o).attr("key");if(k&&v)$(o).text($['mx']['mappdata'][k][v])});$(".filetree").treeview();$(".ajaxform").mxform();$("#treeview-content a[url]").click(function(){var url=$(this).attr("url");$('[itip]').poshytip('hide');mxmask('正在加载...');$("#treeview-content").load(url,loadpubfn);return false});$("#treeview-content a[brurl]").click(function(){var url=$(this).attr("brurl");$.mx.setparam('url',url);$('[itip]').poshytip('hide');mxmask('正在加载...');$("#treeview-content").load(url,loadpubfn);return false});$("#treeview-content a[valurl]").click(function(){var val=$(this).attr("valurl"),churltg=$(this).attr("chvalurl"),churltg=churltg?churltg:val,param=$.mx.getparam(),url=param[val];$.mx.setparam(churltg,url);$('[itip]').poshytip('hide');mxmask('正在加载...');$("#treeview-content").load(url,loadpubfn);return false});$(".mx-list-remove").click(gridlistdel);$("input[name='allselect']:checkbox").click(function(){var check=$(this).attr('checked');check=check?true:false;var ochson=$("input[type='checkbox'][name='checks']");ochson.attr("checked",check);var otr=ochson.parent().parent().parent();check?otr.addClass("trSelected"):otr.removeClass("trSelected")});$("input[type='checkbox'][name='checks']").click(function(){var check=$(this).attr('checked');check=check?true:false;var otr=$(this).parent().parent().parent();check?otr.addClass("trSelected"):otr.removeClass("trSelected")});$(".mx-sysmenu").each(function(i,o){$(o).text($.mx.sysmenu.tab.title+" > "+$.mx.sysmenu.tree.title)});$(".mx-sysmenu-tab").each(function(i,o){$(o).text($.mx.sysmenu.tab.title)});$(".mx-sysmenu-tree").each(function(i,o){$(o).text($.mx.sysmenu.tree.title)})}function gridlistdel(){var delid=$(this).attr("delid"),delname=$(this).attr("delname"),backurl=$(this).attr("backurl"),delurl=$(this).attr("delurl");dialog({title:'提示',content:'确定删除《'+delname+'》吗?,如果确定,删除后将不能恢复!',resizable:false,bgiframe:false,buttons:{'是':function(){var me=this;$.get(delurl+"/id/"+delid+".html",function(){Tip({title:'删除提示:',content:'《'+delname+'》删除成功!'});tabtreecontent(backurl,function(){$(me).dialog('destroy')})})},'否':function(){$(this).dialog('destroy')}}})}function handsort(c){return function(){var ids=[],vals=[];$(c.tb+" input[name='handsort']").each(function(i,o){ids.push($(o).attr("mid"));vals.push($(o).val())});c.post.ids=ids.join(",");c.post.vals=vals.join(",");$.post(c.url,c.post,function(text){Tip({title:'手动排序提示:',content:'手动排序成功!'});tabtreecontent(c.flurl)})}}function moredelete(c){return function(){var ids=[];$(c.tb+" input[name='checks']").each(function(i,o){if($(o).attr("checked"))ids.push($(o).val())});c.post.ids=ids.join(",");if(c.post.ids!=''){$.post(c.url,c.post,function(text){Tip({title:'批量删除提示:',content:'批量删除成功!'});tabtreecontent(c.flurl)})}else{Tip({title:'批量删除提示:',content:'请选择要删除列表项'})}}}function addmapping(k,d){$['mx']['mappdata'][k]=d}function tabtreecontent(url,fn){$("#treeview-content").load(url,function(){$.mx.setparam('url',url);loadpubfn();if(fn)fn()})}function tabmenuurl(url){tabtreecontent(url);$(".filetree a[url]").removeClass("selected");var otree=$("a[url='"+url+"']"),treeid=otree.attr("treeid");$.mx.setparam('treeid',treeid);otree.addClass("selected")}function encode(str){return $.evalJSON(str)}function decode(json){return $.toJSON(json)}function dialog(param){var defaults={id:'mx-dialog-win',modal:true,overlay:{backgroundColor:'#000',opacity:0.5},bgiframe:true,resizable:true,buttons:{Ok:function(){$(this).dialog('destroy')}}};$.extend(defaults,param);if(defaults.title&&defaults.content){$("#"+defaults.id).attr("title",defaults.title);$("#"+defaults.id).html(defaults.content)}$("#"+defaults.id).dialog(defaults)}function Tip(p){var ob=$("#mx-sys-error"),ot=$("#mx-sys-error-title"),oc=$("#mx-sys-error-content"),defaults={title:'无标题',content:'无内容',width:260,second:3000,top:0};$.extend(defaults,p);defaults.left=($(window).width()-defaults.width)/2;ob.css({width:defaults.width,top:defaults.top,left:defaults.left});ot.html(defaults.title);oc.html(defaults.content);ob.slideDown("fast",function(){setTimeout("$('#mx-sys-error').slideUp('fast')",defaults.second)})}function mxuploadfile(){var me=this,fid=$(this).attr("fid"),picid=$(this).attr("picid"),names=[],ids=[],oldnames=$("#mx-form-upload-"+fid).val(),oldids=$("#mx-form-uploadids-"+fid).val();names=oldnames.split(",");ids=oldids.split(",");dialog({id:'mx-uploadwinform',title:'文件上传',width:500,height:360,resizable:false,bgiframe:false,buttons:{'关　闭':function(){$(this).dialog('destroy')}}});var _filters=picid>0?[{"title":"Image files","extensions":"jpg,gif,png"}]:__FILTERS;$("#uploader").pluploadQueue({runtimes:'html5,flash,browserplus,html4',url:'./do/?FileUpload-add/picid/'+picid+'.html',max_file_size:__UPLOADMAXSIZE,chunk_size:'1mb',unique_names:false,filters:_filters,flash_swf_url:'plupload/plupload.flash.swf',init:{FileUploaded:function(up,file,info){var res=encode(info.response);if(res.error){Tip({title:"文件上传提示",content:res.error})}else{if(res.name)names.push(res.name);var _names=[],_nameslen=names.length;for(var i=0;i<_nameslen;i++){if(names[i]!='')_names.push(names[i])}$("#mx-form-upload-"+fid).val(_names.join(","));if(res.id)ids.push(res.id);var _ids=[],_idslen=ids.length;for(var i=0;i<_idslen;i++){if(ids[i]!='')_ids.push(ids[i])}$("#mx-form-uploadids-"+fid).val(_ids.join(","))}},Error:function(up,args){Tip({title:"文件上传提示",content:args.file.name});return}}})}function mximpleupload(){var me=this,fid=$(me).attr("fid"),ag=$(me).attr("ag"),tp=$(me).attr("tp"),id=$(me).attr("nid"),filedname=$("#mx-form-upload-"+fid).attr("name"),fileoldname=$("#mx-form-upload-"+fid).val(),filepath=$("#mx-form-simpleuploadids-"+fid).val();dialog({title:'单文件管理',content:'<div style="text-align:center"><img src="../'+filepath+'" border="0"  /></div>',width:500,height:360,resizable:true,bgiframe:false,buttons:{'删　除':function(){var box=this;$.post("util/grid/do/?Grid-delsimplefile/ag/"+ag+"/tp/"+tp+"/",{id:id,filedname:filedname},function(text){$("#mx-form-upload-"+fid).val("");$("#mx-form-simpleuploadids-"+fid).val("");$(box).dialog('destroy')})},'关　闭':function(){$(this).dialog('destroy')}}})}function mxuploadplist(){var me=this,fid=$(me).attr("fid"),ag=$(me).attr("ag"),tp=$(me).attr("tp"),ids=$("#mx-form-uploadids-"+fid).val(),filedname=$("#mx-form-upload-"+fid).attr("name");dialog({title:'文件管理',content:'<div id="GridBase-filegrids"></div>',width:500,height:360,resizable:false,bgiframe:false,buttons:{'删　除':function(){var idsarr=[];$(".grid-base-brfiles a.selected").each(function(i,o){idsarr.push($(o).attr("pid"))});var idstr=idsarr.join(",");if(idstr==""){Tip({title:"删除提示",content:"请选择要删除的文件!"})}else{$.post("util/grid/do/?Grid-delappends/ag/"+ag+"/tp/"+tp+"/isformeditflag/1/",{ids:idstr,filedname:filedname,fieldnid:fid,oldids:ids},function(text){formmanappends(ag,tp,ids,fid);var otext=eval('('+text+')');$("#mx-form-upload-"+fid).val(otext.names);$("#mx-form-uploadids-"+fid).val(otext.ids)})}},'修改':function(){var upidarr=[],upoldnamearr=[],upsortarr=[],lid='';$(".grid-base-brfiles a[pid]").each(function(i,o){upidarr.push($(o).attr("pid"));upoldnamearr.push($("input[name='oldname']",o).val()+$("input[name='oldname_ext']",o).val());upsortarr.push($("input[name='sort']",o).val());lid=$(o).attr('lid')});if(upidarr.length>0)$.post("util/grid/do/?Grid-sortappends/ag/"+ag+"/tp/"+tp+"/isformeditflag/1/",{upids:upidarr.join(","),upoldnamearr:upoldnamearr.join("||"),upsortarr:upsortarr.join(","),lid:fid,filedname:filedname},function(text){formmanappends(ag,tp,ids,fid);var otext=eval('('+text+')');$("#mx-form-upload-"+fid).val(otext.names);$("#mx-form-uploadids-"+fid).val(otext.ids)})},'关　闭':function(){$(this).dialog('destroy')}}});formmanappends(ag,tp,ids,fid)}function formmanappends(ag,tp,ids,lid){$("#GridBase-filegrids").load("util/grid/?brfiles/ag/"+ag+"/tp/"+tp+"/fid/"+ids+"/lid/"+lid+"/",function(){$(".grid-base-brfiles a").click(function(){$(this).toggleClass("selected")});$(".grid-base-brfiles a").poshytip({className:'tip-yellowsimple',alignTo:'target',alignX:'center',offsetY:5})})}function logout(){dialog({title:'提示',content:'确定退出吗?',resizable:false,bgiframe:false,buttons:{'是':function(){document.location="do/?PlugsUserPass-logout.html"},'否':function(){$(this).dialog('destroy')}}})}function editpassword(){dialog({id:'mx-button-editpassword',resizable:false,bgiframe:false,buttons:{'修改密码':function(){var me=this;$("#mx-ajaxform-editpassword").ajaxSubmit({beforeSubmit:$.mx.validator,success:function(responseText,statusText,xhr,$form){if(responseText=="1"){$("#mx-submitting").hide();$(me).dialog('destroy');Tip({title:"提示",content:'密码修改成功,下次登录生效!'})}else{$("#mx-submitting").hide();Tip({title:"提示",content:responseText})}}})},'关　闭':function(){$(this).dialog('destroy')}}})}function changetheme(){dialog({id:'mx-theme-listview',resizable:false,bgiframe:false,width:430,height:190,buttons:{'确　定':function(){var oselected='',me=this;$("#mx-theme-listview a").each(function(i,o){var cs=$(o).attr("class");oselected=cs=='selected'?o:oselected});if(oselected==''){Tip({title:"更改主题提示",content:"请选择一个主题"})}else{var _theme=$(oselected).attr("theme");$.post("do/?EditUser-theme.html",{theme:_theme},function(text){$(me).dialog('destroy');Tip({title:"更改主题提示",content:"主题修改成功,下次登录生效!"})})}},'关　闭':function(){$(this).dialog('destroy')}}})}function gradesearchclear(t,me){var gdsr=t.attr('downfields');if(gdsr){var downfield=gdsr.split(","),downfdlen=downfield.length;for(var di=0;di<downfdlen;di++){var dftemp=downfield[di],downselect=$('select[name="'+dftemp+'"]',me);downselect.find('option[keyid!=""]').remove();gradesearchclear(downselect)}}}function mxmask(msg){var omask=$("#mx-submitting");if(omask.length<1){omask=$("<div>").appendTo("body");omask.attr("id","mx-submitting");var oling=$("<div>").appendTo(omask);oling.attr("id","mx-subloing");oling.html('<img src="images/loading.gif" align="absmiddle"><span id="mx-submitting-msg"></span>')}var _w=$.mx.width(),_h=$.mx.height();omask.css({width:_w,height:_h});$("#mx-subloing").css({left:(_w-120)/2,top:(_h-30)/2});$("#mx-submitting-msg").html(msg);omask.show()}function mxajaxFileUpload(t){mxmask('正在上传...');var name=$(t).attr('name'),feid=$(t).attr('id'),cw=$(t).attr('cw'),ch=$(t).attr('ch');$.ajaxUpload({url:'do/?ImgUpload-up.html',secureuri:false,fileElementId:feid,dataType:'json',data:{name:name,cw:cw,ch:ch,id:'id'},success:function(data,status){$("#mx-submitting").hide();if(typeof(data.error)!='undefined'){if(data.error!=''){Tip({title:"图片上传提示",content:data.error})}else{if(data.npath!=''){$('#'+feid).trigger('blur');$(t).parent().parent().find('.mxformerrors').hide();$('#'+feid+'-path').val(data.npath);$('#'+feid+'-name').val(data.oldname);$('#'+feid+'-src').show().attr('src',$('#'+feid).attr('prefix')+data.npath)}}}},error:function(data,status,e){$("#mx-submitting").hide();alert(e)}});return false};(function($){$.fn.mxform=function(){var me=this;$.mx.formitemdata=$.mx.formitems(me);$($.mx.formitemdata).blur(function(){return $.mx.formvaildator(me,$(this))});$(me).ajaxForm({beforeSubmit:$.mx.validator,iframe:true,success:function(responseText,statusText,xhr,$form){$("#mx-submitting").hide();if(responseText!=""){$('[itip]').poshytip('hide');var ores=encode(responseText);switch(ores.type){case"msg":Tip({title:ores.title?ores.title:"提示",content:ores.msg});break;case"ajaxcontent":tabtreecontent(ores.url);break;case"tab":tabmenuurl(ores.url);break;case"jump":document.location=ores.url;break}}}});$("td",me).each(function(k,o){var otd=$(this),olabel=otd.find("label"),tdwidth=parseInt(otd.attr("width"))-10,itemarr=["input[type!='hidden'][type!='submit'][type!='checkbox'][type!='radio'][class!='noauto'][class!='Wdate noauto']","select[class!='noauto']","textarea"];for(var i=0;i<itemarr.length;i++){var itdw=otd.find(itemarr[i]);if(itdw.length>0)break}itdw.attr("class")=="mx-fileupload"?itdw.css("width",tdwidth-36):itdw.css("width",tdwidth);olabel.css("width",tdwidth);var ofdplusfn=itdw.attr('fdplusfn');if(ofdplusfn!=''&&$['mx']['fdjsplus'][ofdplusfn]){$['mx']['fdjsplus'][ofdplusfn].init(itdw)}});$('textarea[edit="ckeditor"]',me).each(function(i,o){var editor=CKEDITOR.replace($(this).attr('id'));CKFinder.setupCKEditor(editor,'../~editor/ckeditor/ckfinder/')});$(".mx-formsimpleup-img",me).each(function(i,o){var buttonid=$(o).attr("id"),fieldname=$(o).attr("fieldname"),picid=$(o).attr("picid");var ofdplusfn=$(o).attr('fdplusfn');if(ofdplusfn!=''&&$['mx']['fdjsplus'][ofdplusfn]){$['mx']['fdjsplus'][ofdplusfn].init($(o))}var _filters=picid>0?[{"title":"Image files","extensions":"jpg,gif,png"}]:__FILTERS;var uploader=new plupload.Uploader({runtimes:'html5,flash,browserplus,html4',browse_button:buttonid,container:buttonid+'-div',max_file_size:__UPLOADMAXSIZE,chunk_size:'1mb',url:'./do/?FileUpload-simpleup/picid/'+picid+'.html',flash_swf_url:'plupload/plupload.flash.swf',filters:_filters});uploader.bind('QueueChanged',function(up){mxmask('正在上传请等待!');uploader.start()});uploader.bind('Error',function(up,args){Tip({title:"文件上传提示",content:"【"+args.file.name+"】"+args.message});return});uploader.bind('FileUploaded',function(up,file,info){var res=encode(info.response);$("#mx-submitting").hide();if(res.error){Tip({title:"文件上传提示",content:res.error})}else{var ofdplusfn=$("input[name='"+fieldname+"']",me).attr('fdplusfn');if(ofdplusfn!=''&&$['mx']['fdjsplus'][ofdplusfn]){if($['mx']['fdjsplus'][ofdplusfn].uploaded)$['mx']['fdjsplus'][ofdplusfn].uploaded($(o),res,me)}$("input[name='"+fieldname+"']",me).val(res.name);$("input[name='"+fieldname+"_path']",me).val(res.path)}});uploader.init()});$(".mx-formup-img",me).click(mxuploadfile);$(".datalist",me).each(function(i,o){var width=$(o).parent().attr("width"),col=$(o).attr("col"),wdtp=Math.floor(width/col)-10;$("span",o).each(function(ii,oo){$(oo).css('width',wdtp)});var ofdplusfn=$(o).attr('fdplusfn');if(ofdplusfn!=''&&$['mx']['fdjsplus'][ofdplusfn]){$['mx']['fdjsplus'][ofdplusfn].init($(o))}});$(".mx-fileupload-simpleimg").click(mximpleupload);$(".mx-fileupload-imglist").click(mxuploadplist);$('[type="radio"]',me).click(function(){var n=$(this).attr("name"),kv=$(this).attr("keyid"),kfd=$('input[type="hidden"][name="'+n+'_key"]',me);kfd.val($(this).attr("checked")?kv:kfd.val())});$('[type="checkbox"]',me).click(function(){var n=$(this).attr("name"),nold=n.substr(0,n.length-3),nfd=$('input[type="hidden"][name="'+nold+'"]',me),kfd=$('input[type="hidden"][name="'+nold+'_key"]',me),groups=$('[name="'+n+'"]',me),names=[];vals=[];for(var i=0;i<groups.length;i++){if($(groups[i]).attr("checked")){names.push($(groups[i]).val());vals.push($(groups[i]).attr("keyid"))}}nfd.val(names.join(","));kfd.val(vals.join(","))});$('select',me).change(function(){var n=$(this).attr("name"),opts=$('option',this),kfd=$('input[type="hidden"][name="'+n+'_key"]',me),gdsr=$(this).attr('downfields');for(var i=0;i<opts.length;i++){if(opts.eq(i).attr("selected"))kfd.val(opts.eq(i).attr("keyid"))};if(gdsr){var downfield=gdsr.split(","),downfdlen=downfield.length,selectval=kfd.val();for(var di=0;di<downfdlen;di++){var dftemp=downfield[di],downselect=$('select[name="'+dftemp+'"]',me),dfoptiondata=$('.gradesearchfieldata[name="'+dftemp+'__data"]',me).find('option'),dfoptdatalen=dfoptiondata.length;downselect.find('option[keyid!=""]').remove();for(var dtempi=0;dtempi<dfoptdatalen;dtempi++){var __downoption=dfoptiondata.eq(dtempi);if(__downoption.attr("parentkey")==selectval){downselect.append('<option value="'+__downoption.attr("value")+'" keyid="'+__downoption.attr("keyid")+'">'+__downoption.attr("value")+'</option>')}}gradesearchclear(downselect)}}});var d=$(".mx-formdata",me).val();if(d){var dd=encode(d);var yclfun=$(me).attr('fun');if(yclfun)eval(yclfun+'(dd)');$('[type="text"],[type="hidden"][class!="noload"]',me).each(function(i,o){$(o).val(dd[$(o).attr('name')]);var ofdplusfn=$(o).attr('fdplusfn');if(ofdplusfn!=''&&$['mx']['fdjsplus'][ofdplusfn]){if($['mx']['fdjsplus'][ofdplusfn].load)$['mx']['fdjsplus'][ofdplusfn].load($(o))}});$('select',me).each(function(i,o){var option=$(o).find('option'),optlen=option.length,optval=dd[$(o).attr('name')],gdsr=$(this).attr('downfields'),selectval='';for(var i=0;i<optlen;i++){if($(option[i]).val()==optval){selectval=$(option[i]).attr("keyid");$(option[i]).attr("selected","selected")}}if(gdsr){var downfield=gdsr.split(","),downfdlen=downfield.length;for(var di=0;di<downfdlen;di++){var dftemp=downfield[di],downselect=$('select[name="'+dftemp+'"]'),dfoptiondata=$('.gradesearchfieldata[name="'+dftemp+'__data"]').find('option'),dfoptdatalen=dfoptiondata.length;for(var dtempi=0;dtempi<dfoptdatalen;dtempi++){var __downoption=dfoptiondata.eq(dtempi);if(__downoption.attr("parentkey")==selectval){downselect.append('<option value="'+__downoption.attr("value")+'" keyid="'+__downoption.attr("keyid")+'">'+__downoption.attr("value")+'</option>')}}}}var ofdplusfn=$(o).attr('fdplusfn');if(ofdplusfn!=''&&$['mx']['fdjsplus'][ofdplusfn]){if($['mx']['fdjsplus'][ofdplusfn].load)$['mx']['fdjsplus'][ofdplusfn].load($(o))}});$('textarea[class!="noload"]',me).each(function(i,o){$(o).val(dd[$(o).attr('name')]);var ofdplusfn=$(o).attr('fdplusfn');if(ofdplusfn!=''&&$['mx']['fdjsplus'][ofdplusfn]){if($['mx']['fdjsplus'][ofdplusfn].load)$['mx']['fdjsplus'][ofdplusfn].load($(o))}});$('[type="radio"][class="groupdata"]',me).each(function(i,o){$(o).val()==dd[$(o).attr('name')]?$(o).attr("checked",true):"";var ofdplusfn=$(o).attr('fdplusfn');if(ofdplusfn!=''&&$['mx']['fdjsplus'][ofdplusfn]){if($['mx']['fdjsplus'][ofdplusfn].load)$['mx']['fdjsplus'][ofdplusfn].load($(o))}});$('[type="checkbox"][class="groupdata"]',me).each(function(i,o){var n=$(o).attr("name"),key=$(o).attr("keyid"),nold=n.substr(0,n.length-3),nlv=$('input[type="hidden"][name="'+nold+'_key"]',me).val(),enlv=nlv.split(",");$(o).attr("checked",$.inArray(key,enlv)>-1?true:false);var ofdplusfn=$(o).attr('fdplusfn');if(ofdplusfn!=''&&$['mx']['fdjsplus'][ofdplusfn]){if($['mx']['fdjsplus'][ofdplusfn].load)$['mx']['fdjsplus'][ofdplusfn].load($(o))}});$('[type="file"]',me).each(function(i,o){var fid=$(o).attr('id'),fnpath=$(o).attr('name'),pre=$(o).attr('prefix');$('#'+fid+'-src').show().attr('src',pre+dd[fnpath+'_path'])})}};$.mx.formitems=function(jqForm){var oitems=[];$('input',jqForm).each(function(i,o){oitems.push(o)});$('select',jqForm).each(function(i,o){oitems.push(o)});$('textarea',jqForm).each(function(i,o){oitems.push(o)});$('.datalist',jqForm).each(function(i,o){oitems.push(o)});return oitems};$.mx.formfieldfocus='';$.mx.formvaildator=function(jqForm,oitems){var reg={Require:/.+/,Email:/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/,Phone:/^((\(\d{2,3}\))|(\d{3}\-))?(\(0\d{2,3}\)|0\d{2,3}-)?[1-9]\d{6,7}(\-\d{1,4})?$/,Number:/^\d+$/,NumberSplit:/^[,\d]+$/,Integer:/^[-\+]?\d+$/,English:/^[A-Za-z]+$/,EngNum:/^[A-Za-z\d]+$/,EngNumDl:/^[A-Za-z\d_]+$/,Chinese:/^[\u0391-\uFFE5]+$/},itemlen=oitems.length;for(var i=0;i<itemlen;i++){var oinput=oitems[i],value=$(oinput).val(),_dataType=$(oinput).attr('dataType');var ofdplusfn=$(oinput).attr('fdplusfn');if(ofdplusfn!=''&&$['mx']['fdjsplus'][ofdplusfn]){if($['mx']['fdjsplus'][ofdplusfn].submit)$['mx']['fdjsplus'][ofdplusfn].submit($(oinput))}if(typeof(_dataType)=="object"||typeof(_dataType)=="undefined")continue;if($(oinput).attr("require")=="false"&&value=="")continue;switch(_dataType){case"IdCard":case"Date":case"Repeat":var totag=$(oinput).attr('to'),opv=jqForm.find("input[name='"+totag+"']").val();if(opv!=value){$.mx.formfieldfocus=oinput;$.mx.formfielderror(oinput,true);return false}else{$.mx.formfielderror(oinput,false)}break;case"Range":case"Compare":case"Custom":case"Group":var n=$(oinput).attr("name"),groups=$('input[name="'+n+'"]',jqForm);var hasChecked=0;min=$(oinput).attr("min")||1;max=$(oinput).attr("max")||groups.length;for(var ii=0;ii<groups.length;ii++){if($(groups[ii]).attr("checked"))hasChecked++}if(!(min<=hasChecked&&hasChecked<=max)){$.mx.formfieldfocus=oinput;$.mx.formfielderror(oinput,true);return false}else{$.mx.formfielderror(oinput,false)}break;case"Limit":case"LimitB":case"SafeString":default:if(!reg[_dataType].test(value)){$.mx.formfieldfocus=oinput;$.mx.formfielderror(oinput,true);return false}else{$.mx.formfielderror(oinput,false)}break}}return true};$.mx.formfielderror=function(oinput,t){var _input=$(oinput),_label=_input.parent().find('label');if(t){_input.addClass('dataerror');_label.addClass('tiperror');_label.html(_input.attr("itip"))}else{_input.removeClass('dataerror');_label.removeClass('tiperror');_label.html(_label.attr("text"))}};$.mx.validator=function(formData,jqForm,options){var befun=$(jqForm).attr('befun');if(befun){var p=$['mx']['formbefun'][befun]();if(p&&p.ret==false){if(p.title&&p.msg)Tip({title:p.title,content:p.msg});return false}}var errortag=$.mx.formvaildator(jqForm,$.mx.formitemdata);if(!errortag){if($.mx.formfieldfocus!='')$($.mx.formfieldfocus).focus();return false}mxmask('正在保存数据...')}})(jQuery);